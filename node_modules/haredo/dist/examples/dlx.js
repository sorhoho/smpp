"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.main = void 0;
const __1 = require("..");
const haredo_1 = require("../haredo");
const utils_1 = require("../utils");
exports.main = async () => {
    const rabbit = haredo_1.haredo({
        connection: 'amqp://guest:guest@localhost:5672/'
    });
    const dlx = __1.e('test.dead', 'topic');
    await rabbit
        .queue('test.dead.update')
        .bindExchange(dlx, 'item.*')
        .subscribe(({ routingKey }) => {
        console.log('Found a dead lettered message with routing key', routingKey);
    });
    const queue = __1.q('testqueue').dead(dlx);
    await rabbit
        .queue(queue)
        .bindExchange('test', '#', 'topic')
        .subscribe(({ nack }) => {
        if (Math.random() >= 0.5) {
            console.log('Nacking message');
            return nack(false);
        }
        console.log('Acking message');
    });
    while (true) {
        await rabbit.exchange('test', 'topic').skipSetup().publish('hi', Math.random() >= 0.5 ? 'item.created' : 'item.updated');
        await utils_1.delay(1000);
    }
};
process.nextTick(exports.main);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGx4LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2V4YW1wbGVzL2RseC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwwQkFBMEI7QUFDMUIsc0NBQW1DO0FBQ25DLG9DQUFpQztBQUVwQixRQUFBLElBQUksR0FBRyxLQUFLLElBQUksRUFBRTtJQUMzQixNQUFNLE1BQU0sR0FBRyxlQUFNLENBQUM7UUFDbEIsVUFBVSxFQUFFLG9DQUFvQztLQUNuRCxDQUFDLENBQUM7SUFDSCxNQUFNLEdBQUcsR0FBRyxLQUFDLENBQUMsV0FBVyxFQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3BDLE1BQU0sTUFBTTtTQUNQLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQztTQUN6QixZQUFZLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQztTQUMzQixTQUFTLENBQUMsQ0FBQyxFQUFFLFVBQVUsRUFBRSxFQUFFLEVBQUU7UUFDMUIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxnREFBZ0QsRUFBRSxVQUFVLENBQUMsQ0FBQztJQUM5RSxDQUFDLENBQUMsQ0FBQztJQUNQLE1BQU0sS0FBSyxHQUFHLEtBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7SUFDdkMsTUFBTSxNQUFNO1NBQ1AsS0FBSyxDQUFDLEtBQUssQ0FBQztTQUNaLFlBQVksQ0FBQyxNQUFNLEVBQUUsR0FBRyxFQUFFLE9BQU8sQ0FBQztTQUNsQyxTQUFTLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxFQUFFLEVBQUU7UUFDcEIsSUFBSSxJQUFJLENBQUMsTUFBTSxFQUFFLElBQUksR0FBRyxFQUFFO1lBQ3RCLE9BQU8sQ0FBQyxHQUFHLENBQUMsaUJBQWlCLENBQUMsQ0FBQztZQUMvQixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztTQUN0QjtRQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUNsQyxDQUFDLENBQUMsQ0FBQztJQUNQLE9BQU8sSUFBSSxFQUFFO1FBQ1QsTUFBTSxNQUFNLENBQUMsUUFBUSxDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQyxTQUFTLEVBQUUsQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLENBQUM7UUFDekgsTUFBTSxhQUFLLENBQUMsSUFBSSxDQUFDLENBQUM7S0FDckI7QUFDTCxDQUFDLENBQUM7QUFFRixPQUFPLENBQUMsUUFBUSxDQUFDLFlBQUksQ0FBQyxDQUFDIn0=