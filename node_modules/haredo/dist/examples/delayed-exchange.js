"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.main = void 0;
const haredo_1 = require("../haredo");
const index_1 = require("../index");
const utils_1 = require("../utils");
const prepared_message_1 = require("../prepared-message");
exports.main = async () => {
    const rabbit = haredo_1.haredo({
        connection: 'amqp://guest:guest@localhost:5672/'
    });
    const delayedExchange = index_1.e('my-delayed-exchange', 'x-delayed-message').delayed('topic');
    await rabbit.queue('my-queue')
        .bindExchange(delayedExchange, '#')
        .subscribe(({ data, timestamp }) => {
        console.log(`Received message in ${Date.now() - timestamp}ms id:${data.id} `);
    });
    const delayedMessage = prepared_message_1.preparedMessage().routingKey('item').delay(2000);
    let id = 0;
    while (true) {
        id += 1;
        console.log('Publishing message', id);
        const msg = delayedMessage.json({ id }).timestamp(Date.now());
        await rabbit
            .exchange(delayedExchange)
            .publish(msg);
        await utils_1.delay(2000);
    }
};
process.nextTick(exports.main);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGVsYXllZC1leGNoYW5nZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9leGFtcGxlcy9kZWxheWVkLWV4Y2hhbmdlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHNDQUFtQztBQUNuQyxvQ0FBNkI7QUFDN0Isb0NBQWlDO0FBQ2pDLDBEQUFzRDtBQUV6QyxRQUFBLElBQUksR0FBRyxLQUFLLElBQUksRUFBRTtJQUMzQixNQUFNLE1BQU0sR0FBRyxlQUFNLENBQUM7UUFDbEIsVUFBVSxFQUFFLG9DQUFvQztLQUNuRCxDQUFDLENBQUM7SUFJSCxNQUFNLGVBQWUsR0FBRyxTQUFDLENBQVUscUJBQXFCLEVBQUUsbUJBQW1CLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7SUFDaEcsTUFBTSxNQUFNLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQztTQUN6QixZQUFZLENBQUMsZUFBZSxFQUFFLEdBQUcsQ0FBQztTQUNsQyxTQUFTLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsRUFBRSxFQUFFO1FBQy9CLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUJBQXdCLElBQUksQ0FBQyxHQUFHLEVBQUUsR0FBRyxTQUFVLFNBQVUsSUFBSSxDQUFDLEVBQUcsR0FBRyxDQUFDLENBQUM7SUFDdEYsQ0FBQyxDQUFDLENBQUM7SUFDUCxNQUFNLGNBQWMsR0FBRyxrQ0FBZSxFQUFFLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN4RSxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUM7SUFDWCxPQUFPLElBQUksRUFBRTtRQUNULEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDUixPQUFPLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBQ3RDLE1BQU0sR0FBRyxHQUFHLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUM5RCxNQUFNLE1BQU07YUFDUCxRQUFRLENBQUMsZUFBZSxDQUFDO2FBQ3pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNsQixNQUFNLGFBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQztLQUNyQjtBQUNMLENBQUMsQ0FBQztBQUVGLE9BQU8sQ0FBQyxRQUFRLENBQUMsWUFBSSxDQUFDLENBQUMifQ==