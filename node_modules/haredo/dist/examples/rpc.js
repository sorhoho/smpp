"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.main = void 0;
const __1 = require("..");
const utils_1 = require("../utils");
exports.main = async () => {
    const rabbit = __1.haredo({
        connection: 'amqp://guest:guest@localhost:5672/'
    });
    const queue = __1.q('sum');
    await rabbit
        .queue(queue)
        .autoReply()
        .subscribe(({ data }) => {
        return data.reduce((acc, item) => acc + item, 0);
    });
    while (true) {
        const numbers = [randomBetween(1, 100), randomBetween(1, 100), randomBetween(1, 100)];
        console.log('Asking for sum of', numbers);
        const result = await rabbit.queue(queue).rpc(numbers);
        console.log('Result is', result);
        await utils_1.delay(1000);
    }
};
const randomBetween = (min, max) => {
    return Math.floor(Math.random() * (max - min + 1)) + min;
};
process.nextTick(exports.main);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicnBjLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2V4YW1wbGVzL3JwYy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSwwQkFBK0I7QUFDL0Isb0NBQWlDO0FBRXBCLFFBQUEsSUFBSSxHQUFHLEtBQUssSUFBSSxFQUFFO0lBQzNCLE1BQU0sTUFBTSxHQUFHLFVBQU0sQ0FBQztRQUNsQixVQUFVLEVBQUUsb0NBQW9DO0tBQ25ELENBQUMsQ0FBQztJQUNILE1BQU0sS0FBSyxHQUFHLEtBQUMsQ0FBbUIsS0FBSyxDQUFDLENBQUM7SUFFekMsTUFBTSxNQUFNO1NBQ1AsS0FBSyxDQUFDLEtBQUssQ0FBQztTQUNaLFNBQVMsRUFBRTtTQUNYLFNBQVMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRTtRQUNwQixPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsSUFBSSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3JELENBQUMsQ0FBQyxDQUFDO0lBRVAsT0FBTyxJQUFJLEVBQUU7UUFDVCxNQUFNLE9BQU8sR0FBRyxDQUFDLGFBQWEsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLEVBQUUsYUFBYSxDQUFDLENBQUMsRUFBRSxHQUFHLENBQUMsRUFBRSxhQUFhLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLENBQUM7UUFDdEYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsRUFBRSxPQUFPLENBQUMsQ0FBQztRQUMxQyxNQUFNLE1BQU0sR0FBRyxNQUFNLE1BQU0sQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ3RELE9BQU8sQ0FBQyxHQUFHLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBQ2pDLE1BQU0sYUFBSyxDQUFDLElBQUksQ0FBQyxDQUFDO0tBQ3JCO0FBQ0wsQ0FBQyxDQUFDO0FBRUYsTUFBTSxhQUFhLEdBQUcsQ0FBQyxHQUFXLEVBQUUsR0FBVyxFQUFFLEVBQUU7SUFDL0MsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxNQUFNLEVBQUUsR0FBRyxDQUFDLEdBQUcsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7QUFDN0QsQ0FBQyxDQUFDO0FBRUYsT0FBTyxDQUFDLFFBQVEsQ0FBQyxZQUFJLENBQUMsQ0FBQyJ9