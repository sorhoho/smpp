"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const haredo_1 = require("../haredo");
const index_1 = require("../index");
const backoffs_1 = require("../backoffs");
const main = async () => {
    const chain = haredo_1.haredo({
        connection: 'amqp://guest:guest@localhost:5672/'
    });
    const queue = index_1.q('test').expires(2000);
    await chain.queue(queue)
        // Take a 5 second break when there are 3 errors in 5 seconds
        .backoff(backoffs_1.standardBackoff())
        .subscribe(({ data }) => {
        console.log(data);
        throw new Error('Failed to process message');
    });
    await chain.queue(queue).publish({ time: Date.now() });
};
process.nextTick(main);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFja29mZi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9leGFtcGxlcy9iYWNrb2ZmLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsc0NBQW1DO0FBQ25DLG9DQUE2QjtBQUM3QiwwQ0FBOEM7QUFFOUMsTUFBTSxJQUFJLEdBQUcsS0FBSyxJQUFJLEVBQUU7SUFDcEIsTUFBTSxLQUFLLEdBQUcsZUFBTSxDQUFDO1FBQ2pCLFVBQVUsRUFBRSxvQ0FBb0M7S0FDbkQsQ0FBQyxDQUFDO0lBQ0gsTUFBTSxLQUFLLEdBQUcsU0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN0QyxNQUFNLEtBQUssQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDO1FBQ3BCLDZEQUE2RDtTQUM1RCxPQUFPLENBQUMsMEJBQWUsRUFBRSxDQUFDO1NBQzFCLFNBQVMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLEVBQUUsRUFBRTtRQUNwQixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2xCLE1BQU0sSUFBSSxLQUFLLENBQUMsMkJBQTJCLENBQUMsQ0FBQztJQUNqRCxDQUFDLENBQUMsQ0FBQztJQUNQLE1BQU0sS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQyxPQUFPLENBQUMsRUFBRSxJQUFJLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQztBQUMzRCxDQUFDLENBQUM7QUFFRixPQUFPLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxDQUFDIn0=